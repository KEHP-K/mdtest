---
id: blog5_nodejs
title: 가제5
---

안녕하세요, ~ 입니다.

저번에는 우리 Opsilo 에 대해서 소개를 드렸죠?

이번 시간 부터는 실제로 간단한 앱을 개발하고, 이를 간단히 배포해보는 과정을 보여드리고자 합니다.

Opsilo 에서 사용 가능한 여러가지 앱 타입에 따라 하나하나 짚어볼 예정이고, 정말 간단하게 구성했습니다.

또, 배포 과정 또한 정말 간단하니까, 가벼운 마음과 함께 산책하듯 따라가 봅시다.

저번에도 강조했지만, 여러분이 많은 작업을 거쳐야 할 필요는 없습니다.

왜냐?

**Opsilo**가 알아서 해결해 줄테니까요.

시작하겠습니다.

---

## Node.js


Opsilo 에서 제공하는 App type은 가지가 있습니다.

Java, Python, Node.js, Nginx, Docker

이 중, 우리는 첫 번째로 **Node.js**에 대해 다루어 보겠습니다.

![사진 - nodejs]()

**Node.js**는 **JavaScript**를 기반으로 만들어졌으며, 보통 웹 서버를 제작하는 데에 사용됩니다.

웹 페이지에서 스크립트를 작성할 때 JavaScript를 사용하기에, Node.js를 사용하면 서버에서와 웹 페이지에서 같은 언어를 사용하게 되고, 이는 웹 앱 개발에 있어 큰 이득을 가져다 줍니다.

또한, **npm**의 존재는 원활한 모듈의 사용을 도와주어 매우 편리합니다.

그리고 보통 웹에 대해 처음 입문할 때, 많은 분들이 Node.js를 알게 되고, 사용해보기 때문에 이를 처음으로 보여드리고자 생각했습니다.

---

### My Project

함께 차차히 짚어 나가기 전, 여러분과 함께 보기 위해 미리 제작한 앱에 대해 소개하겠습니다.

![사진 1,2]()
(캡션 - 간단하게 게시판을 만들어 보았습니다.)

이 프로젝트로 말씀 드릴 것 같으면, Opsilo 게시판 입니다.

이렇게 간단한 게시판을 제작해 보았습니다. 기능으로는 기본적인 것들, 목록 열람, 세부 열람, 글쓰기, 수정, 삭제, 이렇게 가지고 있습니다.

앱을 제작하는 데에 도움을 받기 위해, 백엔드 프레임워크로는 **Express**를 사용했고, **MariaDB**와 연동하는 작업까지 수행했습니다.

혹시나 Node.js에 대해 잘 몰라서, 코드가 나올 때 마다 이해하기 힘든 분이 있을 수 있다고 생각합니다.

그래서 코드는 최소한으로, 있더라도 잘 풀어서 설명해 볼테니 너무 걱정 마세요.

필요하다면, 아래 주소에서 소스 코드를 확인하시길 바랍니다.

<https://github.com/KEHP-K/Simple-CRUD>
(개인 github 주소라서, 문제가 있을 수 있다면 회사에서 쓰는 계정으로 fork 하여 주소를 써주시면 될 듯 합니다.)

한 가지 더, 필자의 환경은 Mac OS 이니, 문제 발생 시 참고하시기 바랍니다.

---

### First Touch

**Just Do It!**

우선 Opsilo 앱 생성부터 시작해 봅시다. 설명이 필요한 부분은 중간 중간 곁들이도록 하겠습니다.

![사진 3]()
(캡션 - Opsilo 앱을 생성해봅시다.)

먼저 **opsilo (app) create** 를 통해 nodejs type의 앱을 생성해 보았습니다.

저는 input type으로 local을 선택하여 사용 하였고, git을 사용해도 문제는 발생하지 않으니, 편하신 방법으로 선택하시기 바랍니다.

![사진 4]()
(캡션 - Git 으로 생성)

git을 사용한 경우 입니다. Branch 설정에 대한 default는 master입니다. 실수 안하도록 주의하세요!

![사진5]()

다음으로 앱에 접근할 수 있도록 주소를 생성하여 배정해 주었습니다.

opsilo에서 port에 대한 default는 8080 입니다. 앱 또한 그렇게 port를 설정해 주었습니다.

이렇게 하면, 우선 앱을 배포할 준비가 되었습니다. opsilo push 를 통해 진행해 볼까요?

결과를 봅시다.

![사진 6, 7]()

…뭔가 잘못되었군요. 조금 더 생각해봅시다.

앱 구조를 다시 한번 생각해봅시다.

이 Opsilo 게시판에는 우리 눈으로 볼 수 있는 웹페이지가 있고, 보이지 않는 부분에 Node.js를 이용한 서버가 있습니다.

그리고 그 서버는 별도의 DB서버와 연결해서 데이터를 관리하죠.

우리가 배포한 앱이 작동하는 곳, Opsilo Cluster는 많은 작업을 대신 해주지만, 무에서 유를 창조해 낼 수는 없습니다.

그리고 Opsilo 에서는 DB 서버를 구축할 수 있도록 서비스를 제공합니다. **Managed app** 이라는 이름으로 말이죠.

---

### Database, Managed App

Opsilo 에서는 두 가지 종류의 DBMS를 사용할 수 있습니다. **MariaDB**, **PostgreSQL**.

프로젝트에서 사용한 바에 따라, 이 중 MariaDB를 이용하여 DB를 구축해보겠습니다.

![사진 8]()
(캡션 - 세부 정보는 비밀입니다! 본인이 원하는 대로 설정 넣어주세요!)

(보여드릴 것이 있어서 완성 코드에서 조금 수정을 가했습니다.)

코드 상에서 DB 연동과 관련한 부분을 작성해줍니다.

![사진 9]()

**Sequelize ORM**을 사용한 것인데, 코드 해석을 조금 하면, 내가 설정하고자 하는 DB에 대한 정보를 넣어주는 부분입니다.

여기서 특이점이 하나 있는데요, 본래 host 부분에는 어떤 주소에 따라가야 DB에 접근할 수 있는지를 명시해 주는데, host에 DB의 이름을 넣어주게 되면 Opsilo에서 그 정보만으로도 찾아갈 수 있게 되어, 좀 더 간편하게 설정을 할 수 있습니다.

이와 다른 방식으로 DB와 연동을 하고, 적용을 한다고 해도 이와 흡사한 부분은 고려해주시면 좋겠습니다.

자, 다시 시도해 봅시다. **opsilo push**.

![사진 10]()
(캡션 - Main page가 잘 나옵니다.)

잘 되는군요!

만들어놓은 기능을 점검해봅시다.

우리가 봐야할 것은 글이 생성, 수정, 삭제가 잘 되는지에 대한 여부입니다.

![사진 11, 12, 13]()
(캡션 - 게시글 생성이 잘 됩니다.)

![사진 14, 15]()
(캡션 - 게시글 수정도 잘 되네요.)

![사진 16, 17]()
(캡션 - 게시글 삭제까지 잘 마쳤습니다.)

이로써 Node.js 타입에 대한 배포 과정을 같이 알아봤습니다.

잘 작동 하는군요! 일단은요.

하지만 저는 조금만 더 욕심내고 싶은 부분이 보인답니다.

지금부터는 떠나셔도 좋습니다. 따라오실 분은 따라와주시길. 

심화 과정을 밟아 보겠습니다.

---

### More and More

조금 더 알려드리고 싶은 사항이 있습니다.

**보안**을 위해 보완하면 좋은 점입니다.

지금 우리가 작업을 하면서, DB의 정보를 코드에 그대로 작성해 주었습니다. 이는 사실 굉장히 바람직하지 못한, 권장되지 않는 방법입니다.

만약 누군가 코드를 뜯어본다면 바로 서버에 그치지 않고 DB에 침범할 수 있기 때문입니다.

![사진 - 해커(크래커)]())

그렇기에 지금 소개할 내용은 그 정보를 분리하는 방법입니다.

우리는 Opsilo app을 생성하면서 설정할 수 있는 환경 변수, 그리고 Node.js에서 어떤 모듈을 사용하는 것을 동시에 적용하면서 그 방법을 실행해 보겠습니다.

![사진 18]()
(캡션 - 앱을 새로 생성한다면, 아까는 지나쳤던 부가 설정을 거쳐가도록 합시다.)

![사진 19]()
(캡션 - 이미 앱이 있다면, opsilo의 config에 접근하여 위와 같은 방식으로 환경 변수를 4개 추가해보도록 합시다.)

이렇게 환경 변수를 설정하고 나면, 앱에서 이를 받아서 적용해주어야 합니다.

저는 Node.js의 **dotenv**를 사용해보겠습니다. dotenv의 세부 사용법에 대해서는 다루지 않을테니, 직접 찾아봐주세요!

![사진 20]()
(캡션 - dotenv 사용하면서 추가하는, 환경 변수에 대한 정보를 기재한 파일 .env)

![사진 21]()
(캡션 - 아까 DB 연동에 관한 코드입니다. DB 설정이 들어가는 부분을 우리가 명시한 대로 바꿔줍니다.)

위의 ${info} 는 서버가 작동하는 환경의 환경 변수를 받게 됩니다. 

DB_NAME을 예로 들면, 우리는 Opsilo 환경 변수에서 DB_NAME=** 이라고 설정해 주었습니다.

그 말은 즉, .env 파일에서 DB_NAME=${DB_NAME} => DB_NAME=** 이 됩니다.

그렇게 하여 모든 설정을 마치고, 다시 실행해 봅시다.

![사진 22]()
(캡션 - 아까 설정을 바꾸기 전과 동일하게 잘 작동합니다.)

이러한 과정을 통해 DB를 조금 더 보호할 수 있게 됩니다. 지금까지 심화 과정 이었습니다.

---

### 마무리

오늘은 Node.js app type을 적용하여 Opsilo에 배포하는 과정을 함께 해 보았습니다.

어때요, 정말 쉽죠?

다음 시간에는 또 다른 app type을 가지고 다뤄보는 시간을 가져보도록 하겠습니다.

다음 글도 기대해주세요.